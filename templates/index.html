
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Health Hub</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container mt-4">
        <div class="text-center mb-4">
            <h1 class="display-4">Heart Health Hub</h1>
            <p class="lead">Your personal tool for understanding cardiovascular risk.</p>
        </div>

        <!-- Tab Navigation -->
        <ul class="nav nav-tabs" id="modelTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="cardio-tab" data-bs-toggle="tab" data-bs-target="#cardio" type="button" role="tab" aria-controls="cardio" aria-selected="true">Cardiovascular Disease</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="heart-attack-tab" data-bs-toggle="tab" data-bs-target="#heart-attack" type="button" role="tab" aria-controls="heart-attack" aria-selected="false">Heart Attack Risk</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="heart-disease-tab" data-bs-toggle="tab" data-bs-target="#heart-disease" type="button" role="tab" aria-controls="heart-disease" aria-selected="false">Heart Disease Diagnosis</button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="modelTabsContent">
            <!-- Cardiovascular Disease Tab -->
            <div class="tab-pane fade show active" id="cardio" role="tabpanel" aria-labelledby="cardio-tab">
                <div class="p-4 border rounded-bottom">
                    <h3 class="mb-3">General Cardiovascular Disease Risk</h3>
                    <form action="/predict_cardio" method="post">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="age" class="form-label">Age (years)</label>
                                <input type="number" class="form-control" name="age" id="age" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="gender" class="form-label">Gender (1=Female, 2=Male)</label>
                                <input type="number" class="form-control" name="gender" id="gender" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="height" class="form-label">Height (cm)</label>
                                <input type="number" class="form-control" name="height" id="height" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="weight" class="form-label">Weight (kg)</label>
                                <input type="number" class="form-control" name="weight" id="weight" step="0.1" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="ap_hi" class="form-label">Systolic Blood Pressure</label>
                                <input type="number" class="form-control" name="ap_hi" id="ap_hi" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="ap_lo" class="form-label">Diastolic Blood Pressure</label>
                                <input type="number" class="form-control" name="ap_lo" id="ap_lo" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="cholesterol" class="form-label">Cholesterol (1-3)</label>
                                <input type="number" class="form-control" name="cholesterol" id="cholesterol" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="gluc" class="form-label">Glucose (1-3)</label>
                                <input type="number" class="form-control" name="gluc" id="gluc" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="smoke" class="form-label">Smoker (0=No, 1=Yes)</label>
                                <input type="number" class="form-control" name="smoke" id="smoke" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="alco" class="form-label">Alcohol (0=No, 1=Yes)</label>
                                <input type="number" class="form-control" name="alco" id="alco" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="active" class="form-label">Active (0=No, 1=Yes)</label>
                                <input type="number" class="form-control" name="active" id="active" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Calculate Risk</button>
                    </form>
                </div>
            </div>

            <!-- Heart Attack Risk Tab -->
            <div class="tab-pane fade" id="heart-attack" role="tabpanel" aria-labelledby="heart-attack-tab">
                <div class="p-4 border rounded-bottom">
                    <h3 class="mb-3">Heart Attack Risk Assessment</h3>
                    <form action="/predict_heart_attack" method="post">
                        <div class="row">
                            <!-- All 23 fields for the heart attack model will go here, structured in a responsive grid -->
                            <div class="col-md-4 mb-3"><label class="form-label">Age</label><input type="number" class="form-control" name="Age" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Gender</label><select class="form-select" name="Gender" required><option value="Male">Male</option><option value="Female">Female</option></select></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Diabetes (0/1)</label><input type="number" class="form-control" name="Diabetes" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Hypertension (0/1)</label><input type="number" class="form-control" name="Hypertension" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Obesity (0/1)</label><input type="number" class="form-control" name="Obesity" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Smoking (0/1)</label><input type="number" class="form-control" name="Smoking" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Alcohol (0/1)</label><input type="number" class="form-control" name="Alcohol_Consumption" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Physical Activity</label><input type="number" class="form-control" name="Physical_Activity" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Diet Score (1-10)</label><input type="number" class="form-control" name="Diet_Score" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Cholesterol</label><input type="number" class="form-control" name="Cholesterol_Level" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Triglycerides</label><input type="number" class="form-control" name="Triglyceride_Level" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">LDL</label><input type="number" class="form-control" name="LDL_Level" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">HDL</label><input type="number" class="form-control" name="HDL_Level" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Systolic BP</label><input type="number" class="form-control" name="Systolic_BP" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Diastolic BP</label><input type="number" class="form-control" name="Diastolic_BP" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Air Pollution</label><input type="number" class="form-control" name="Air_Pollution_Exposure" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Family History (0/1)</label><input type="number" class="form-control" name="Family_History" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Stress (1-10)</label><input type="number" class="form-control" name="Stress_Level" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Healthcare Access (0/1)</label><input type="number" class="form-control" name="Healthcare_Access" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Heart Attack History (0/1)</label><input type="number" class="form-control" name="Heart_Attack_History" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Response Time</label><input type="number" class="form-control" name="Emergency_Response_Time" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Annual Income</label><input type="number" class="form-control" name="Annual_Income" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Health Insurance (0/1)</label><input type="number" class="form-control" name="Health_Insurance" required></div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 mt-3">Calculate Risk</button>
                    </form>
                </div>
            </div>

            <!-- Heart Disease Diagnosis Tab -->
            <div class="tab-pane fade" id="heart-disease" role="tabpanel" aria-labelledby="heart-disease-tab">
                <div class="p-4 border rounded-bottom">
                    <h3 class="mb-3">Clinical Heart Disease Diagnosis Aid</h3>
                     <form action="/predict_heart_disease" method="post">
                        <div class="row">
                            <div class="col-md-4 mb-3"><label class="form-label">Age</label><input type="number" class="form-control" name="age" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Sex (0=F, 1=M)</label><input type="number" class="form-control" name="sex" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Chest Pain Type</label><input type="number" class="form-control" name="cp" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Resting BP</label><input type="number" class="form-control" name="trestbps" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Cholesterol</label><input type="number" class="form-control" name="chol" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Fasting BS > 120 (0/1)</label><input type="number" class="form-control" name="fbs" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Resting ECG</label><input type="number" class="form-control" name="restecg" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Max Heart Rate</label><input type="number" class="form-control" name="thalach" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Exercise Angina (0/1)</label><input type="number" class="form-control" name="exang" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Oldpeak</label><input type="number" class="form-control" name="oldpeak" step="0.1" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Slope</label><input type="number" class="form-control" name="slope" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Major Vessels (ca)</label><input type="number" class="form-control" name="ca" required></div>
                            <div class="col-md-4 mb-3"><label class="form-label">Thal</label><input type="number" class="form-control" name="thal" required></div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 mt-3">Analyze Data</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Prediction Result Modal -->
        <div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="resultModalLabel">Prediction Report</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Content will be injected by JavaScript -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Activate the correct tab if the server indicates one should be active
            const activeTabId = '{{ active_tab }}';
            if (activeTabId) {
                const tabButton = document.querySelector(`#${activeTabId}-tab`);
                if (tabButton) {
                    const tab = new bootstrap.Tab(tabButton);
                    tab.show();
                }
            }

            // Show the modal with the prediction report if it exists
            const predictionReport = {{ prediction_report|tojson|safe }};
            if (predictionReport && Object.keys(predictionReport).length > 0) {
                const modalBody = document.querySelector('#resultModal .modal-body');
                const modalTitle = document.querySelector('#resultModal .modal-title');

                if (predictionReport.error) {
                    modalTitle.textContent = 'Error';
                    modalBody.innerHTML = `<p class="text-danger">${predictionReport.error}</p>`;
                } else {
                    modalTitle.textContent = predictionReport.title;
                    modalBody.innerHTML = \`
                        <div class="text-center">
                            <h3>Risk Score</h3>
                            <p class="display-4 fw-bold \${predictionReport.risk_percentage.split('.')[0] > 50 ? 'text-danger' : 'text-success'}">
                                \${predictionReport.risk_percentage}
                            </p>
                        </div>
                        <hr>
                        <h5>Interpretation</h5>
                        <p>\${predictionReport.interpretation}</p>
                        <h5>General Suggestions</h5>
                        <ul>
                            \${predictionReport.suggestions.map(s => `<li>\${s}</li>`).join('')}
                        </ul>
                        <hr>
                        <p class="text-muted small"><em>\${predictionReport.disclaimer}</em></p>
                    \`;
                }

                const resultModal = new bootstrap.Modal(document.getElementById('resultModal'));
                resultModal.show();
            }
        });
    </script>
</body>
</html>
